<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NostrCal - Book an Appointment</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <!-- Input Section -->
  <div id="inputSection" class="homepage">
    <h1>ğŸ“… Book an Appointment</h1>
    <p>
      Enter your Nostr booking link (naddr) to view available time slots and schedule your appointment on the decentralized web.
    </p>
    
    <div class="input-form" style="max-width: 500px; margin: 0 auto;">
      <input 
        type="text" 
        class="form-input" 
        id="naddrInput"
        placeholder="nostr:naddr1..."
        style="margin-bottom: 1rem;"
      >
      <button class="btn-primary" id="loadBtn" onclick="loadAvailability()" style="width: 100%;">
        Load Availability
      </button>
    </div>
    
    <div id="errorMessage" class="hidden" style="max-width: 500px; margin: 1rem auto; background-color: #fef2f2; border: 1px solid #fecaca; color: #dc2626; padding: 1rem; border-radius: 0.5rem;"></div>
    
    <div id="loadingMessage" class="loading hidden">
      <div class="spinner"></div>
      Loading availability...
    </div>
  </div>

  <!-- Booking Interface -->
  <div id="bookingInterface" class="hidden">
    <div style="min-height: 100vh; background-color: #0a0a0a; padding: 2rem;">
      <div class="container">
        <button class="btn-secondary" onclick="goBack()" style="margin-bottom: 1rem;">â† Back to link entry</button>
        
        <!-- Event Header -->
        <div class="event-card" style="background: linear-gradient(135deg, #7c3aed, #a855f7); color: white; margin-bottom: 2rem;">
          <div style="display: flex; align-items: center; gap: 1rem;">
            <div class="avatar" id="hostAvatar" style="width: 60px; height: 60px; font-size: 1.5rem; background-color: rgba(255,255,255,0.2);">ğŸ“…</div>
            <div>
              <h2 id="eventTitle" style="font-size: 1.5rem; margin-bottom: 0.5rem;">Loading...</h2>
              <div class="event-meta" style="color: rgba(255,255,255,0.9);">
                <span>â±ï¸ <span id="eventDuration">30 min</span></span>
                <span>ğŸŒ <span id="eventTimezone">UTC</span></span>
              </div>
            </div>
          </div>
        </div>

        <!-- Booking Content -->
        <div style="display: flex; gap: 2rem; min-height: 500px; flex-wrap: wrap;">
          <!-- Calendar Section -->
          <div class="event-card" style="flex: 2; min-width: 300px; padding: 2rem;">
            <div class="calendar-controls" style="margin-bottom: 2rem;">
              <h3 id="monthYear" style="margin: 0;">Loading...</h3>
              <div style="display: flex; gap: 1rem;">
                <button class="btn-secondary" onclick="previousMonth()">â€¹ Previous</button>
                <button class="btn-secondary" onclick="nextMonth()">Next â€º</button>
              </div>
            </div>
            
            <div id="bookingCalendar">
              <!-- Generated by JavaScript -->
            </div>
          </div>

          <!-- Time Slots Section -->
          <div class="event-card" style="flex: 1; min-width: 250px; padding: 2rem; background-color: #374151;">
            <div style="margin-bottom: 1.5rem;">
              <div class="selected-date" id="selectedDate">Select a date</div>
              <div class="timezone" id="timezoneDisplay">Local time</div>
            </div>
            
            <div id="timeSlots" style="display: flex; flex-direction: column; gap: 0.75rem; max-height: 400px; overflow-y: auto;">
              <div class="no-times">ğŸ‘ˆ Select a date to see available times</div>
            </div>

            <button class="btn-primary hidden" id="bookBtn" onclick="confirmBooking()" style="width: 100%; margin-top: 1rem; background-color: #059669;">
              ğŸ“… Request Booking
            </button>
          </div>
        </div>

        <div id="bookingStatus" class="hidden"></div>
      </div>
    </div>
  </div>

  <!-- Load scripts -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
  <script src="https://unpkg.com/nostr-login@1.7.7/dist/unpkg.js" 
          data-perms="sign_event:31923"
          data-methods="connect,extension"
          data-theme="dark"
          data-dark-mode="true"
          data-start-screen="login"
          data-no-banner="true"></script>
  <script src="booking.js"></script>
</body>
</html>